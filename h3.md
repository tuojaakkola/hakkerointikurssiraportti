# h3)

Tehtävä h3 löytyy osoitteesta https://terokarvinen.com/application-hacking/#laksyt .
Tehtävät on tehty virtuaalikoneella, jossa pyörii Linux Ubuntu.

## a)

Latasin `ezbin-challenges.zip` -tiedoston suoraan läksysivulta, jolloin se ilmestyi koneeni Lataukset-kansioon.
Siellä purin tiedoston komennolla `unzip ezbin-challenges.zip`. Purkaminen loi `challenges`-kansion, josta löytyi tehtävänannossa mainittu `passtr`-tiedosto.

<img width="919" height="101" alt="kuva" src="https://github.com/user-attachments/assets/d7a7192d-a44c-442b-afd7-cf97505989ad" />

Ajoin `passtr`-ohjelman komennolla `./passtr`, jolloin se kysyi "What's the password?". Laitoin testiksi "secret", jolloin se vastasi: "Sorry, no bonus."
Tutkin tiedostoa `strings`-komennolla, niin kuin tehtävänannossa sanottiin. `strings`-komento lukee ja kertoo binääritiedostosta kaikki selkeät sanat, joissa on vähintään 4 merkkiä putkeen.
Komennon luettelemasta listasta löytyi rivi `sala-hakkeri-321` ja FLAG.

<img width="919" height="101" alt="kuva" src="https://github.com/user-attachments/assets/341ab60f-bf0e-4481-bc0f-50fa4144670f" />

Kokeilin salasanaa ja se oli oikein.

<img width="919" height="101" alt="kuva" src="https://github.com/user-attachments/assets/bb209a22-cfaa-4ca7-aed3-f0e586a3107c" />

**Käytetty aika 0.5h**

## b)

Avasin Microssa `passtr.c`-ohjelman ja aloin tutkia sitä. Ohjelmassa on `if-else`-lause rivillä 12, jossa verrataan annettua salasanaa merkkijonoon "sala-hakkeri-321". Tässä paljastuu salasana. Aloin googlailla, miten tällaisessa tilanteessa salasanan saa piilotettua.
Luin artikkelin seitsemästä tavasta sotkea koodia (Zimperium), jossa kerrottiin, että tiedon tallentaminen erilaisilla hieman monimutkaisemmilla tavoilla toimii.
Muokkasin ohjelmaa niin, että salasana tallennetaan taulukkoon yksi merkki kerrallaan. Tämän pitäisi estää `strings`-komentoa löytämästä suoraan salasanaa, koska merkkijono ei enään binäärissä ole eheä pötkö vaan jokaisen kirjaimen väliin tulee konekieltä.

<img width="917" height="734" alt="kuva" src="https://github.com/user-attachments/assets/f069ae13-c23b-4220-ba70-daf2a56bc7aa" />

Tallensin ja suljin Micron, mutta `strings` palauttaa silti vielä salasanan. Ongelma oli kääntämisessä. Ohjelma piti kääntää uudestaan komennolla `make`, jolloin muutokset vasta päivittyvät uuteen versioon sovelluksesta, eikä salasana löydy `strings`-komennolla.

<img width="917" height="66" alt="kuva" src="https://github.com/user-attachments/assets/b40870f7-09d9-4fef-b58a-95c34acd2acd" />

**Käytetty aika 1h**

## c)

Ajoin `packd`-tiedoston ja totesin sen toiminnan olevan täysin sama kuin aikaisemmalla `passtr`-tiedostolla. Se kysyy salasanaa ja kertoo sen olevan väärin.
Ajoin `strings`-komennon ja löysin vastauksesta "piilos-An" -rivin. Kokeilin sitä salasanaa, mutta se ei ollut oikea. Katsoin ensimmäistä vihjettä, jossa puhuttiin pakatusta binääristä. Tutkin `strings`-komennon palauttamia rivejä lisää ja löysin rivin, jossa puhuttiin pakatusta binääristä.

<img width="917" height="66" alt="kuva" src="https://github.com/user-attachments/assets/930a864e-6d74-4e97-90f1-595d9ffc2972" />

Löysin netistä raportin, jossa selvitettiin tällainen haaste, jossa purettiin binäärissä oleva UPX-paketti (Astrah, Medium). Seurasin raporttia ja koitin purkaa paketin komennolla: `upx -d packd`. Jouduin asentamaan työkalun purkaakseni UPX-paketin.

<img width="917" height="66" alt="kuva" src="https://github.com/user-attachments/assets/f63bb084-a553-4c2d-8385-8d884cef4f37" />

Asensin työkalun suoraan terminaalin ehdotuksesta, mutta se olikin väärä, jolloin purku ei onnistunut.

<img width="917" height="683" alt="kuva" src="https://github.com/user-attachments/assets/b9e989e6-9821-4dd2-a031-06a09553bafa" />

Pienen selvittelyn jälkeen asensin oikean työkalun `upx-ucl` ja koitin uudestaan onnistuneesti.

<img width="931" height="211" alt="kuva" src="https://github.com/user-attachments/assets/4847ea9e-3485-40d1-afca-5bc8e6425f75" />

Onnistuneen UPX-paketin purkamisen jälkeen `strings`-komento antoi flagin ja salasanan:

<img width="931" height="123" alt="kuva" src="https://github.com/user-attachments/assets/a1371c45-6d9c-4e56-a5ea-e1dd8902404e" />

Kokeilin salasanaa ja se oli oikea.

<img width="931" height="123" alt="kuva" src="https://github.com/user-attachments/assets/0e85653c-ce95-46b8-843e-fd6dfb0dd42d" />

**Käytetty aika 1.5h**

## Lähteet
* https://zimperium.com/blog/top-7-source-code-obfuscation-techniques
* https://yurisk.info/2017/06/25/binary-obfuscation-string-obfuscating-in-C/
* https://www.reddit.com/r/C_Programming/comments/gri58y/how_to_hide_characters_when_doing_strings_on_my/
* https://astrah.medium.com/reverse-engineering-upx-packed-executable-d9ed7df2f72
* Gemini 3 Pro konseptien kuten strings komennon ymmärtämiseen
